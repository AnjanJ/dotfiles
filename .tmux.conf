# ============================================
# TMUX CONFIGURATION
# ============================================
# Author: AJ
# Created: 2025-11-23
# Description: Tmux configuration inspired by ThePrimeagen
#              Session management, vim integration, modern workflow
# ============================================
#
# QUICK REFERENCE:
# ──────────────────────────────────────────
#  Prefix: Ctrl+A (instead of default Ctrl+B)
#
#  Sessions:
#    tmux new -s name     Create new session
#    prefix d             Detach from session
#    tmux ls              List sessions
#    tmux attach -t name  Attach to session
#
#  Windows (like browser tabs):
#    prefix c             Create window
#    prefix ,             Rename window
#    prefix n             Next window
#    prefix p             Previous window
#    prefix 0-9           Go to window number
#    prefix &             Kill window
#
#  Panes (splits):
#    prefix |             Split vertical
#    prefix -             Split horizontal
#    prefix h/j/k/l       Navigate panes (vim-style)
#    prefix H/J/K/L       Resize panes
#    prefix x             Kill pane
#    prefix z             Zoom pane (fullscreen toggle)
#    prefix q             Show pane numbers
#
#  Other:
#    prefix r             Reload config
#    prefix I             Install plugins (TPM)
#    prefix U             Update plugins (TPM)
#
# ============================================

# ============================================
# GENERAL SETTINGS
# ============================================

# Change prefix from Ctrl+B to Ctrl+A (more ergonomic)
unbind C-b
set -g prefix C-a
bind C-a send-prefix

# Enable mouse support (scroll, click, resize panes)
set -g mouse on

# Start windows and panes at 1, not 0 (keyboard left-to-right)
set -g base-index 1
setw -g pane-base-index 1

# Renumber windows when one is closed
set -g renumber-windows on

# Increase scrollback buffer
set -g history-limit 50000

# Display tmux messages for 4 seconds
set -g display-time 4000

# Refresh status bar more frequently (default is 15s)
set -g status-interval 5

# Focus events enabled for terminals that support them
set -g focus-events on

# Super useful when using "grouped sessions" and multi-monitor setup
setw -g aggressive-resize on

# Set terminal colors (important for vim/neovim colors)
set -g default-terminal "screen-256color"
set -ga terminal-overrides ",xterm-256color:Tc"

# Enable true color support
set-option -sa terminal-overrides ',xterm-256color:RGB'

# Set default shell to zsh
set -g default-shell /bin/zsh

# ============================================
# KEY BINDINGS
# ============================================

# Reload configuration
bind r source-file ~/.tmux.conf \; display "Config reloaded!"

# Split panes with | and - (more intuitive than " and %)
bind | split-window -h -c "#{pane_current_path}"
bind - split-window -v -c "#{pane_current_path}"
unbind '"'
unbind %

# Create new window in current path
bind c new-window -c "#{pane_current_path}"

# Vim-style pane navigation
bind h select-pane -L
bind j select-pane -D
bind k select-pane -U
bind l select-pane -R

# Vim-style pane resizing
bind -r H resize-pane -L 5
bind -r J resize-pane -D 5
bind -r K resize-pane -U 5
bind -r L resize-pane -R 5

# Quick pane cycling (prefix + Ctrl+h cycles through panes)
bind -r C-h select-window -t :-
bind -r C-l select-window -t :+

# Synchronize panes (type in all panes at once)
bind S setw synchronize-panes

# Break pane into new window
bind b break-pane -d

# Join pane from another window
bind-key @ command-prompt -p "Join pane from:" "join-pane -s '%%'"

# Quick session switching
bind-key C-j choose-tree -s

# Kill session/window/pane without confirmation
bind-key X confirm-before -p "Kill session #S? (y/n)" kill-session
bind-key x kill-pane
bind-key & kill-window

# ============================================
# COPY MODE (VI-STYLE)
# ============================================

# Use vim keybindings in copy mode
setw -g mode-keys vi

# Enter copy mode with prefix + [
# (default, no need to rebind)

# Begin selection with 'v' (like vim visual mode)
bind-key -T copy-mode-vi 'v' send -X begin-selection

# Copy selection with 'y' (like vim yank)
bind-key -T copy-mode-vi 'y' send -X copy-selection-and-cancel

# Rectangle selection with 'r'
bind-key -T copy-mode-vi 'r' send -X rectangle-toggle

# ============================================
# STATUS BAR
# ============================================
# NOTE: Status bar is now managed by Tokyo Night theme plugin
# The configuration below is commented out as the plugin handles it
# To customize Tokyo Night theme, see PLUGIN CONFIGURATIONS section
# ============================================

# # Status bar position
# set -g status-position top

# # Status bar colors (Catppuccin-inspired)
# set -g status-style 'bg=#1e1e2e fg=#cdd6f4'

# # Status left (session name)
# set -g status-left-length 40
# set -g status-left '#[fg=#89b4fa,bold]❐ #S #[fg=#6c7086]│ '

# # Status right (date, time, hostname)
# set -g status-right-length 80
# set -g status-right '#[fg=#6c7086]│ #[fg=#f38ba8]#{battery_percentage} #[fg=#6c7086]│ #[fg=#94e2d5]%Y-%m-%d #[fg=#6c7086]│ #[fg=#89dceb]%H:%M #[fg=#6c7086]│ #[fg=#a6e3a1]#H'

# # Window status
# setw -g window-status-format '#[fg=#6c7086] #I:#W '
# setw -g window-status-current-format '#[fg=#89b4fa,bold] #I:#W '

# # Window status separator
# setw -g window-status-separator ''

# # Pane border colors
# set -g pane-border-style 'fg=#6c7086'
# set -g pane-active-border-style 'fg=#89b4fa'

# # Message colors
# set -g message-style 'bg=#313244 fg=#cdd6f4 bold'

# ============================================
# TPM (TMUX PLUGIN MANAGER)
# ============================================
# Plugins will be installed to ~/.tmux/plugins/
#
# To install plugins:
#   1. Add plugin below
#   2. Press prefix + I (capital i)
#
# To update plugins:
#   prefix + U
#
# To remove plugin:
#   1. Remove/comment line below
#   2. Press prefix + alt + u
# ============================================

# List of plugins
set -g @plugin 'tmux-plugins/tpm'                   # Plugin manager itself
set -g @plugin 'tmux-plugins/tmux-sensible'         # Sensible defaults
set -g @plugin 'tmux-plugins/tmux-resurrect'        # Restore sessions after restart
set -g @plugin 'tmux-plugins/tmux-continuum'        # Auto-save sessions
set -g @plugin 'tmux-plugins/tmux-yank'             # Better clipboard integration
set -g @plugin 'tmux-plugins/tmux-battery'          # Battery status in status bar
set -g @plugin 'christoomey/vim-tmux-navigator'     # Seamless vim/tmux navigation
set -g @plugin 'tmux-plugins/tmux-open'             # Open files/urls from tmux
set -g @plugin 'janoamaral/tokyo-night-tmux'        # Tokyo Night theme

# ============================================
# PLUGIN CONFIGURATIONS
# ============================================

# tmux-resurrect: Save and restore sessions
# Restore vim sessions
set -g @resurrect-strategy-vim 'session'
# Restore neovim sessions
set -g @resurrect-strategy-nvim 'session'
# Restore pane contents
set -g @resurrect-capture-pane-contents 'on'
# Restore additional programs
set -g @resurrect-processes 'ssh mysql psql sqlite3 "~rails server" "~rails console" "~mix phx.server" "~iex -S mix"'

# tmux-continuum: Auto-save sessions every 15 minutes
set -g @continuum-restore 'on'
set -g @continuum-save-interval '15'
# Show save status in status bar
set -g @continuum-boot 'on'
set -g @continuum-boot-options 'iterm,fullscreen'

# tmux-yank: Copy to system clipboard
# Use 'y' in copy mode to copy to clipboard
set -g @yank_selection 'clipboard'
set -g @yank_selection_mouse 'clipboard'

# vim-tmux-navigator: Navigate seamlessly between vim and tmux
# Use Ctrl+h/j/k/l to navigate between vim splits and tmux panes
# No configuration needed, works automatically

# tokyo-night-tmux: Beautiful Tokyo Night theme
# Repository: https://github.com/janoamaral/tokyo-night-tmux
set -g @tokyo-night-tmux_window_id_style digital
set -g @tokyo-night-tmux_pane_id_style hsquare
set -g @tokyo-night-tmux_zoom_id_style dsquare
set -g @tokyo-night-tmux_show_datetime 1
set -g @tokyo-night-tmux_date_format YMD
set -g @tokyo-night-tmux_time_format 24H

# ============================================
# NESTED TMUX SESSIONS (for SSH)
# ============================================
# When SSH'd into a remote machine running tmux,
# you can toggle local/remote control with F12

bind -T root F12  \
  set prefix None \;\
  set key-table off \;\
  set status-style "fg=#6c7086,bg=#1e1e2e" \;\
  set window-status-current-format "#[fg=#6c7086,bold] #I:#W " \;\
  set window-status-current-style "fg=#6c7086,bold,bg=#1e1e2e" \;\
  if -F '#{pane_in_mode}' 'send-keys -X cancel' \;\
  refresh-client -S \;\

bind -T off F12 \
  set -u prefix \;\
  set -u key-table \;\
  set -u status-style \;\
  set -u window-status-current-style \;\
  set -u window-status-current-format \;\
  refresh-client -S

# ============================================
# DEVELOPMENT WORKFLOWS
# ============================================

# Rails development shortcuts
bind-key r new-window -n "rails-server" "cd #{pane_current_path} && rails server"
bind-key C new-window -n "rails-console" "cd #{pane_current_path} && rails console"

# Phoenix development shortcuts
bind-key P new-window -n "phoenix-server" "cd #{pane_current_path} && mix phx.server"
bind-key I new-window -n "iex" "cd #{pane_current_path} && iex -S mix"

# Git shortcuts
bind-key g new-window -n "lazygit" "cd #{pane_current_path} && lazygit"

# ============================================
# INITIALIZE TPM (KEEP THIS AT THE BOTTOM!)
# ============================================
# This must be the last line in the config

run '~/.tmux/plugins/tpm/tpm'

# ============================================
# POST-INSTALL INSTRUCTIONS
# ============================================
# 1. Open tmux: `tmux`
# 2. Install plugins: prefix + I (capital i)
# 3. Wait for installation to complete
# 4. Reload config: prefix + r
# 5. Start using tmux!
#
# To restore saved sessions after restart:
#   - Sessions are auto-saved every 15 minutes
#   - After restart, just run `tmux` and sessions restore automatically
#   - Manual restore: prefix + Ctrl+r
#   - Manual save: prefix + Ctrl+s
#
# ============================================
